<?xml version="1.0"?>
<launch>
  <!-- UTM 좌표계 기반 GPS 네비게이션 launch 파일 -->
  
  <!-- 파라미터 설정 -->
  <arg name="world_name" default="clearpath_playpen"/>
  <arg name="utm_zone" default="52"/>  <!-- 한국 기준 UTM Zone -->
  <arg name="utm_band" default="S"/>   <!-- 한국 기준 UTM Band -->
  
  <!-- 가제보 환경과 휴스키 로봇 실행 (GPS 센서 포함) -->
  <include file="$(find husky_dwa_gazebo)/launch/husky_ouster_dwa.launch"/>

  <!-- GPS Heading 초기화 노드 -->
  <node pkg="husky_dwa_navigation" type="gps_heading_initializer.py" name="gps_heading_initializer" output="screen">
    <param name="fixed_frame" value="utm"/>
    <param name="robot_frame" value="base_link"/>
    <param name="gps_frame" value="gps_link"/>
    <param name="min_speed_threshold" value="0.3"/>    <!-- 최소 이동 속도 (m/s) -->
    <param name="heading_samples" value="15"/>         <!-- heading 계산용 샘플 수 -->
    <param name="forward_distance" value="3.0"/>       <!-- 전방 목표 거리 (m) -->
    <param name="utm_zone" value="$(arg utm_zone)"/>
    <param name="utm_band" value="$(arg utm_band)"/>
  </node>

  <!-- UTM 기반 Localization 노드 -->
  <node pkg="husky_dwa_navigation" type="utm_localization_node.py" name="utm_localization" output="screen">
    <param name="fixed_frame" value="utm"/>
    <param name="robot_frame" value="base_link"/>
    <param name="odom_frame" value="odom"/>
    <param name="map_frame" value="map"/>
    <param name="gps_frame" value="gps_link"/>
    <param name="gps_weight" value="0.7"/>             <!-- GPS 가중치 -->
    <param name="odom_weight" value="0.2"/>            <!-- Odometry 가중치 -->
    <param name="imu_weight" value="0.1"/>             <!-- IMU 가중치 -->
    <param name="max_gps_age" value="2.0"/>            <!-- GPS 데이터 최대 나이 (초) -->
    <param name="utm_zone" value="$(arg utm_zone)"/>
    <param name="utm_band" value="$(arg utm_band)"/>
  </node>

  <!-- 포인트 클라우드 처리 파이프라인 -->
  <node pkg="nodelet" type="nodelet" name="pcl_manager" args="manager" output="screen"/>
  

</launch>